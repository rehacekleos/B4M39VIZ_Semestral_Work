<!--Copyright (c) 2021 Ladislav Čmolík

Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is 
hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE 
INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE 
FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS 
OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING 
OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>VIZ D3.js Example</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <script>
        var width = 800;
        var height = 600;
        var count = 100;
        var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", [0, 0, width, height])
        .style("border", "1px solid black")
        .on("click", deselected);
        var g = svg.append("g");

        //Create random data
        var data = [];
        for(i = 0; i < count; i++) {
            data[i] = { x: Math.random()*600, y: Math.random()*400, r: Math.random()*50, c: Math.floor(Math.random()*3)}
        }

        //Map data om graphical elements
        var color = ["yellow", "green", "blue"];
        g.selectAll("circle")
        .data(data)
        .enter().append("circle")
        .attr("id", (d, i) => "circle" + i)
        .attr("cx", d => d.x)
        .attr("cy", d => d.y)
        .attr("r", d => d.r)
        .attr("fill", d => color[d.c])
        .attr("stroke", "black")
        .on("click", selected); //Here we are adding selection

        //Calculate and set initial transformation matrix
        var minX;
        var maxX;
        var minY;
        var maxY;
        var first = true;
        for(circle of g.selectAll("circle")) {
            var cx = Number(circle.getAttribute("cx"));
            var cy = Number(circle.getAttribute("cy"));
            var r = Number(circle.getAttribute("r"));
            if(first) {
                first = false;
                minX = cx - r;
                maxX = cx + r;
                minY = cy - r;
                maxY = cy + r;
            }
            else {
                minX = Math.min(minX, cx - r);
                maxX = Math.max(maxX, cx + r);
                minY = Math.min(minY, cy - r);
                maxY = Math.max(maxY, cy + r);
            }
        }
        var sceneWidth = maxX - minX;
        var sceneHeight = maxY - minY;
        var scale = Math.min(width/sceneWidth, height/sceneHeight);  

        var zoomExtent = d3.zoom().scaleExtent([0.1, 10]).on("zoom", zoomed);
        svg.call(zoomExtent);
        svg.call(zoomExtent.transform, d3.zoomIdentity.scale(scale).translate(-minX, -minY));

        function deselected(event, d) {
            d3.selectAll("circle").attr("stroke", "black");
            event.stopPropagation();
        }

        function selected(event, d) { 
            deselected(event, d);
            event.srcElement.setAttribute("stroke", "red");
        }

        function zoomed({transform}) {
            g.attr("transform", transform);
        }
    </script>
</body>
</html>  